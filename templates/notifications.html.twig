{% extends 'base_template.html.twig' %}

{% block title %}Notifications - {{ constant('WEBSITE_TITLE')}} {% endblock %}

{% block content %}
<main>
    <div class="container">
        <div class="row">
            <div class="row text-center mt-3">
				<strong><h1>Mes demandes de contact</h1></strong>
			</div>
            <div class="row text-center mt-5 mb-3 pt-5">
				<h3>Mes demandes envoyées</h3>
			</div>
			{% if demandesContactEnvoyees|length > 0 %}
				<table id="myTable1" class="table table-striped mw-75"> <!-- w-75 fonctionne mais pas mw-75 SUS -->
					<thead>
						<tr>
							<th></th>
							<th>Prenom</th>
							<th>Nom</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						{% for demande in demandesContactEnvoyees %}
							<tr>
								<td><img src="image/photo_user/{{ demande.photoDeProfil }}" alt="photoDeProfil"  class="rounded-circle" style="width: 50px; height: 50px;"></td>
								<td>{{ demande.prenom }}</td>
								<td>{{ demande.nom }}</td>
								<td>
									<a class="" role="button" href="" data-bs-toggle="modal" data-bs-target="#fenetreModaleDemandeAnnulation{{demande.id}}" aria-expanded="false">
										<i class="fa-solid fa-trash"></i>
									</a>
								</td>
							</tr>
							<div class="modal fade" id="fenetreModaleDemandeAnnulation{{demande.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
								<div class="modal-dialog modal-lg">
									<div class="modal-content">
										<div class="modal-header">
											<h1 class="modal-title fs-5" id="exampleModalLabel">Suppression de la demande de contact de
												{{demande.prenom}}
												{{demande.nom}}</h1>
											<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<form action="index.php?controleur=utilisateur&methode=supprimerDemandeContactEmise&id={{ demande.id }}" method="POST" enctype="multipart/form-data">
											<div class="modal-body">
												<label>Êtes-vous sûr de vouloir supprimer la demande concernant le contact
													{{demande.prenom}}
													{{demande.nom}}
													?</label>
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-primary" name="update_article">Supprimer</button>
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						{% endfor %}
					</tbody>
				</table>
			{% else %}
				<div class="row justify-content-center mt-4 h-25">
					<div class="col-md-8">
						<div class="alert alert-info text-center" role="alert">
							Aucune demande envoyée. Ajoutez un contact pour envoyer une demande !
						</div>
					</div>
				</div>
			{% endif %}

			<div class="row text-center mb-3 pt-5 mt-5">
				<h3>Mes demandes reçues</h3>
			</div>
			{% if demandesContactRecues|length > 0 %}
			<table id="myTable2" class="table table-striped mw-75">
				<thead>
					<tr>
						<th></th>
						<th>Prenom</th>
						<th>Nom</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					{% for demande in demandesContactRecues %}
						<tr>
							<td><img src="image/photo_user/{{ demande.photoDeProfil }}" alt="photoDeProfil"  class="rounded-circle" style="width: 50px; height: 50px;"></td>
							<td>{{ demande.prenom }}</td>
							<td>{{ demande.nom }}</td>
							<td>
								<a role="button" href="#" data-bs-toggle="modal" data-bs-target="#fenetreModaleRecueAccepte{{demande.id}}" aria-expanded="false">
								<i class="fa-solid fa-check"></i></a>
								<a role="button" href="#" data-bs-toggle="modal" data-bs-target="#fenetreModaleRecueRefuse{{demande.id}}" aria-expanded="false">
								<i class="fa-solid fa-trash"></i></a>
							</td>
						</tr>
						<div class="modal fade" id="fenetreModaleRecueAccepte{{demande.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="exampleModalLabel">Accepter la demande de 
											{{demande.prenom}}
											{{demande.nom}}</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<form action="index.php?controleur=utilisateur&methode=accepterDemandeContactRecue&id={{ demande.id }}" method="POST" enctype="multipart/form-data">
										<div class="modal-body">
											<label>Êtes-vous sûr de vouloir accepter la demande de contact de 
												{{demande.prenom}}
												{{demande.nom}}
												?</label>
										</div>
										<div class="modal-footer">
											<button type="submit" class="btn btn-primary" name="update_article">Accepter</button>
											<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
										</div>
									</form>
								</div>
							</div>
						</div>
						<div class="modal fade" id="fenetreModaleRecueRefuse{{demande.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="exampleModalLabel">Refuser la demande de 
											{{demande.prenom}}
											{{demande.nom}}</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<form action="index.php?controleur=utilisateur&methode=refuserDemandeContactRecue&id={{ demande.id }}" method="POST" enctype="multipart/form-data">
										<div class="modal-body">
											<label>Êtes-vous sûr de vouloir refuser la demande de contact de 
												{{demande.prenom}}
												{{demande.nom}}
												?</label>
										</div>
										<div class="modal-footer">
											<button type="submit" class="btn btn-primary" name="update_article">Refuser</button>
											<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					{% endfor %}
				</tbody>
			</table>
			{% else %}
				<div class="row justify-content-center mt-4 h-25">
					<div class="col-md-8">
						<div class="alert alert-info text-center" role="alert">
							Aucune demande en attente. Revenez plus tard !
						</div>
					</div>
				</div>
			{% endif %}
			<div class="text-center pt-5">
				<a class="px-5 btn btn-secondary" href="index.php?controleur=contacts&methode=lister" role="button">Afficher mes contacts</a>
			</div>
			<div class="text-center pt-3">
				<a class="px-5 btn btn-primary" href="index.php?controleur=contacts&methode=afficherUtilisateurs" role="button">Ajouter un contact</a>
			</div>
			<div class="row text-center mt-3">
				<strong><h1>Mes demandes de groupe</h1></strong>
			</div>
			<div class="row text-center mb-3 pt-5 mt-5">
				<h3>Mes demandes reçues</h3>
			</div>
			{% if demandesGroupeRecues|length > 0 %}
			<table id="myTable2" class="table table-striped mw-75">
				<thead>
					<tr>
						<th>Nom du Groupe</th>
						<th>Description</th>
						<th>Chef</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					{% for demande in demandesGroupeRecues %}
						<tr>
							<td>{{ demande.nomGr }}</td>
							<td>{{ demande.description }}</td>
							<td>{{ demande.nom }} {{ demande.prenom }}</td>
							<td>
								<a role="button" href="#" data-bs-toggle="modal" data-bs-target="#fenetreModaleRecueAccepte{{demande.id}}" aria-expanded="false">
								<i class="fa-solid fa-check"></i></a>
								<a role="button" href="#" data-bs-toggle="modal" data-bs-target="#fenetreModaleRecueRefuse{{demande.id}}" aria-expanded="false">
								<i class="fa-solid fa-trash"></i></a>
							</td>
						</tr>
						<div class="modal fade" id="fenetreModaleRecueAccepte{{demande.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="exampleModalLabel">Accepter la demande d'ajout au groupe {{demande.nomGr}}</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<form action="index.php?controleur=utilisateur&methode=accepterDemandeGroupeRecue&id={{ demande.id }}" method="POST" enctype="multipart/form-data">
										<div class="modal-body">
											<label>Êtes-vous sûr de vouloir accepter la demande d'ajout au groupe {{demande.nomGr}}	?</label>
										</div>
										<div class="modal-footer">
											<button type="submit" class="btn btn-primary" name="update_article">Accepter</button>
											<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
										</div>
									</form>
								</div>
							</div>
						</div>
						<div class="modal fade" id="fenetreModaleRecueRefuse{{demande.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="exampleModalLabel">Refuser la demande d'ajout au groupe {{demande.nomGr}}</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<form action="index.php?controleur=utilisateur&methode=refuserDemandeGroupeRecue&id={{ demande.id }}" method="POST" enctype="multipart/form-data">
										<div class="modal-body">
											<label>Êtes-vous sûr de vouloir refuser la demande d'ajout au groupe {{demande.nomGr}} ?</label>
										</div>
										<div class="modal-footer">
											<button type="submit" class="btn btn-primary" name="update_article">Refuser</button>
											<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					{% endfor %}
				</tbody>
			</table>
			{% else %}
				<div class="row justify-content-center mt-4 h-25">
					<div class="col-md-8">
						<div class="alert alert-info text-center" role="alert">
							Aucune demande en attente. Revenez plus tard !
						</div>
					</div>
				</div>
			{% endif %}

			<div class="text-center pt-5">
				<a class="px-5 btn btn-secondary" href="index.php?controleur=groupes&methode=lister" role="button">Afficher mes groupes</a>
			</div>
			<div class="text-center pt-3">
				<a class="px-5 btn btn-primary" href="index.php?controleur=groupes&methode=ajouter" role="button">Créer un groupe</a>
			</div>
        </div>
		<!-- Affichage des messages -->
		{% if message %}
			<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1600">
				<div id="toast" class="toast align-items-center text-white bg-{% if contientErreurs %}danger{% else %}success{% endif %} border-0" role="alert" aria-live="assertive" aria-atomic="true">
					<div class="d-flex">
						<div class="toast-body">
							{% for messages in message %}
								{{ messages }}
								<br>
							{% endfor %}
						</div>
						<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
					</div>
				</div>
			</div>
		{% endif %}
    </div>
</main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            $('#myTable1').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json'
                },
                responsive: true, // Important pour les petits écrans
                autoWidth: false, // Évite les problèmes de calcul automatique de largeur
                pageLength: 10,
                ordering: true
            });
        });
        $(document).ready(function() {
            $('#myTable2').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json'
                },
                responsive: true, // Important pour les petits écrans
                autoWidth: false, // Évite les problèmes de calcul automatique de largeur
                pageLength: 10,
                ordering: true
            });
        });
    </script>
{% endblock %}